{% extends "base.html" %}
{% block title %}포토존 순서 예약하기{% endblock %}

{% block extra_head %}
    <style>
        .modal {
            display: none; position: fixed; z-index: 10; left: 0; top: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: 10px;
            width: 90%; max-width: 300px; text-align: center;
        }
        .modal-buttons button {
            margin: 10px; padding: 10px 20px; font-size: 16px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="title">포토존 순서 예약하기</div>

    <form method="post" id="reservationForm">
        <div class="name-row">
            <div class="label">이름 :</div>
            <div class="input-wrapper" style="gap: 8px;">
                <input id="nameInput" class="input-box" name="name" placeholder="이름을 입력해주세요" required style="min-width: 180px;" />
                <span style="font-size: 16px;">가교/결</span>
            </div>
        </div>

        {% if message %}
            <div class="message">{{ message }}</div>
        {% endif %}

        <div class="slot-section">
            <div class="label">시간 선택</div>
            <div class="slots">
                {% for t in timeslots %}
                    {% set hour = t[:16] %}
                    {% if '12:30' <= hour[11:] %}
                        <button type="button" class="slot" onclick="openModal('{{ t }}')">{{ t[11:] }}</button>
                    {% else %}
                        <button class="slot {% if t.full %}full{% endif %}" name="timeslot" value="{{ t }}" type="submit" {% if t.full %}disabled{% endif %}>
                            {{ t[11:] }} {% if t.full %}(마감){% endif %}
                        </button>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </form>

    <!-- ✅ 모달 -->
    <div id="timeModal" class="modal">
        <div class="modal-content">
            <h3 id="modal-time-label">시간 선택</h3>
            <form method="post">
                <input type="hidden" name="name" id="modal-name" />
                <input type="hidden" name="timeslot" id="modal-timeslot" />
                <div class="modal-buttons">
                    <button type="submit" onclick="setArea('안')">안쪽</button>
                    <button type="submit" onclick="setArea('밖')">바깥</button>
                    <button type="button" onclick="closeModal()">닫기</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let selectedTime = "";
        function openModal(time) {
            selectedTime = time;
            const nameValue = document.getElementById("nameInput").value.trim();
            if (!nameValue) {
                alert("이름을 먼저 입력해주세요.");
                return;
            }
            document.getElementById("modal-name").value = nameValue;
            document.getElementById("modal-time-label").innerText = time.slice(11) + " 시간 예약";
            document.getElementById("timeModal").style.display = "flex";
        }

        function setArea(area) {
            document.getElementById("modal-timeslot").value = selectedTime + " (" + area + ")";
        }

        function closeModal() {
            document.getElementById("timeModal").style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target === document.getElementById("timeModal")) {
                closeModal();
            }
        }
    </script>
{% endblock %}
